# spreadCocoa_log

## 趣旨と使い方
接触確認アプリCOCOAで、動作情報をzipファイルで保存できるようになりました。
そのzipファイルには最大14のcsvファイルが入っており、内容を目視確認するまでのファイル操作が煩雑でした。
このGoogle Apps Scriptは、gmailで、添付ファイルとして  cocoa_log xx .zip  を受信した際に、スターと、cocoaLogというラベルを付けた状態で実行します。
すると、予め指定したGoogleDriveのフォルダーに添付ファイルをzipのまま、送信者名などをファイル名に付与して保存し、かつ、新しいSpreadSheetを自動生成し、最大14のｃｓｖをそれぞれのシートにします。
１メールに複数のcocoa_logが添付されていても対応できるようにしてあります。

## 実行例
このようなスプレッドシートが生成されます。キーの一致もないデータですがサンプルです。単にCSVを開いただけですが、日時情報をスプレッドシートのタイムゾーンへと勝手に（自動で）変換されている可能性があります。
https://docs.google.com/spreadsheets/d/1JQ93YOYXGThU59o1_e6hnCbWTAunQ_2813h6DsLnOw0/edit?usp=sharing

（6/13-6/17はこの端末はダウンロードがありませんでした。あまり日本国内で使われていない端末なので対応すべきとも思われません）

## 対象者
Google Apps Script を使うことができる人向けです。ご自身のGAS環境にコピーして、ご自身のgmailとご自身のSpreadsheetでご利用ください。

## cocoa_logについて
cocoa_logの読み方は、こちらの「接触日シート別冊p.2」に整理しています。
https://datastudio.google.com/reporting/069598a2-3f01-4b51-b023-cdb478992182/page/2pXIC

動作確認ができるような改変にご関与いただいた皆様に感謝申し上げます。

## ご活用への期待
Androidユーザーさまは、OS側で提供キーの一致がでても、ハッシュ値から非公式な接触日を推定することができません。

しかし、このcocoa_logの　「output_date」　と　「DaysSinceLastExposure:」　の値から、広範な接触　（１m以内１５分以上の濃厚接触ではない陽性登録者さんとのすれ違い）　の日付を推定できます。

この接触日の推定値を使って、ご自身やご家族又は職場の方などの感染リスクを把握して、社会経済活動をしつつ、リスクの少ない行動を賢く実践いただけたらと思います。

iPhoneユーザーさまは、このcocoa_logの解析でHASH値による接触日よりも詳しい情報を得ることはありませんが、zipファイルを正常に受信しているか、照合動作がちゃんと行われているかなどをcocoa_logから確認することができます。

## ご利用に際してのお願い

スクリプトのコードは、対価不要で自由に改変してご活用いただけますが、このコードを使ったサービスの提供に際して有償化やご自身がコントロールできる範囲で広告収入を得る設定とすることはご遠慮いただければと思います。また、思い通りの動作をしていない部分もありますので、自己責任でお願いします。cocoa_log送信者のプライバシー確保にご配慮ください。

また、gmailはスレッドの扱いが複雑で添付のあるすべての受信メールをもれなく対象とできていない可能性があるため、受信メールのリストと適宜対応させていただきながらご利用ください。

スクリプトは、スプレッドシートに展開したログを記録するように改変予定です。

鈴木健治
